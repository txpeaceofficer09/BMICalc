<!DOCTYPE html>
<html>
	<head>
		<title>BMI Calculator</title>
		<HTA:APPLICATION ID="BMICalc" APPLICATIONNAME="BMI Calculator" SCROLL="no" SINGLEINSTANCE="yes" WINDOWSTATE="normal" BORDER="thin" icon="BMICalc.ico">
		<style>

			body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
			.container { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
			h2 { text-align: center; }
			label { display: block; }
			select, input { margin-bottom: 7px; }
			button { width: 100%; padding: 10px; background: #0078d7; color: white; border: none; cursor: pointer; margin-top: 8px; }
			button:hover { background: #66aaff; }
			#result { margin-top: 15px; font-weight: bold; color: #333333; }

		</style>
		<script>

			var shell = new ActiveXObject("WScript.Shell");
			var regPath = "HKCU\\Software\\BMICalc\\Units";

			function loadSettings() {
				window.resizeTo(350, 455);
				try {
					var savedUnit = shell.RegRead(regPath);
					if ( savedUnit ) document.getElementById('units').value = savedUnit;
				} catch (e) {
				
				}
				changeUnits();
			}

			function saveSettings() {
				var currentUnit = document.getElementById('units').value;
				
				shell.RegWrite(regPath, currentUnit, "REG_SZ");
				changeUnits();
			}

			function changeUnits() {
				var unit = document.getElementById('units').value;
				var weightInput = document.getElementById('weight');
				var heightInput = document.getElementById('height');
				var weightLabel = document.getElementById('weightLabel');
				var heightLabel = document.getElementById('heightLabel');

				if ( unit == "metric" ) {
					weightLabel.innerHTML = "Weight (kg):";
					heightLabel.innerHTML = "Height (m):";
				} else {
					weightLabel.innerHTML = "Weight (lb):";
					heightLabel.innerHTML = "Height (in):";
				}
			}

			function calculateBMI() {
				var weight = parseFloat(document.getElementById('weight').value);
				var height = parseFloat(document.getElementById('height').value);

				if ( isNaN(weight) || isNaN(height) || height <= 0 ) {
					alert("Please enter valid positive numbers.");
					return;
				}

				var bmi = weight / (height * height);
				var category = "";
				var color = "";

				if ( document.getElementById('units').value === "imperial" ) bmi = bmi * 703;

				if ( bmi < 18.5 ) { category = "Underweight"; color = "#17a2b8"; }
				else if ( bmi < 25 ) { category = "Normal weight"; color = "#28a745"; }
				else if ( bmi < 30 ) { category = "Overweight"; color = "#ffc107"; }
				else { category = "Obese"; color = "#dc3545"; }

				var resultDiv = document.getElementById('result');
				resultDiv.style.color = color;
				resultDiv.innerHTML = "Your BMI: " + bmi.toFixed(2) + "<br>Category: " + category;
			}

		</script>
	</head>
	<body onLoad="loadSettings()">
		<div class="container">
			<h2>BMI Calculator</h2>

			<label>Units:</label>
			<select id="units" onChange="saveSettings()">
				<option value="metric">Metric (kg / m)</option>
				<option value="imperial">Imperial (lbs / in)</option>
			</select>

			<label id="weightLabel">Weight (kg):</label>
			<input type="text" id="weight" placeHolder="e.g. 70">

			<label id="heightLabel">Height (meters):</label>
			<input type="text" id="height" placeHolder="e.g. 1.75">

			<button onClick="calculateBMI();">Calculate</button>

			<div id="result">&nbsp;<br>&nbsp;</div>
		</div>
	</body>
</html>